<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DShare - Home</title>
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/transfer.css"> 
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>

    <header class="main-header">
        <div class="header-action-left">
            <button id="backBtn" class="nav-btn invisible"><i class='bx bx-chevron-left'></i></button>
        </div>
        
        <div class="logo">D<span>Share</span></div>

        <div class="header-action-right">
            <a href="settings.html" class="nav-btn"><i class='bx bx-cog'></i></a>
        </div>
    </header>

    <main class="content-area">
        <div class="status-bar">
            <h2 id="viewTitle">Main Vault</h2>
            <button id="addFolderBtn" class="neon-plus"><i class='bx bx-plus'></i></button>
        </div>

        <div class="file-grid" id="fileGrid">
            </div>

        <input type="file" id="fileInput" hidden multiple>
    </main>

    <div class="bottom-dock-container">
        <button class="dock-btn" onclick="openModal('receiveModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Receive</span>
        </button>

        <button class="dock-btn" onclick="openModal('historyModal')">
            <i class='bx bx-history' style="font-size: 20px;"></i>
            <span>History</span>
        </button>

        <button class="dock-btn" onclick="openModal('sendModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            <span>Send</span>
        </button>
    </div>

    <div id="sendModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Send Files</h3>
                <button class="close-btn" onclick="closeModal('sendModal')">&times;</button>
            </div>

            <div id="send-step-1" class="step-content active">
                <p class="step-desc">Enter the 6-digit Receiver PIN.</p>
                
                <div class="pin-wrapper" onclick="document.getElementById('real-pin').focus()">
                    <input type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6" id="real-pin" autocomplete="off">
                    
                    <div class="pin-visuals">
                        <div class="pin-box"></div>
                        <div class="pin-box"></div>
                        <div class="pin-box"></div>
                        <div class="pin-box"></div>
                        <div class="pin-box"></div>
                        <div class="pin-box"></div>
                    </div>
                </div>

                <button class="modal-action-btn" onclick="nextStep()">Connect & Select Files</button>
                <p id="pin-error" style="color: #ef4444; font-size: 12px; margin-top: 15px; display: none; text-align: center;">Please enter all 6 digits.</p>
            </div>

            <div id="send-step-2" class="step-content">
                <p class="step-desc">Select from your folders or attach new files.</p>
                
                <div class="file-selection-list">
                    <label class="file-item">
                        <input type="checkbox">
                        <span class="icon">üìÅ</span>
                        <span class="name">Project Alpha</span>
                    </label>
                    <label class="file-item">
                        <input type="checkbox">
                        <span class="icon">üìÑ</span>
                        <span class="name">Design_v2.fig</span>
                    </label>
                </div>

                <div class="upload-area">
                    <span>+ Attach External File</span>
                </div>

                <div class="modal-footer">
                    <button class="text-btn" onclick="prevStep()">Back</button>
                    <button class="modal-action-btn success">Send Now</button>
                </div>
            </div>
        </div>
    </div>

    <div id="receiveModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Incoming Files</h3>
                <button class="close-btn" onclick="closeModal('receiveModal')">&times;</button>
            </div>
            <div class="receive-list">
                <p class="empty-state">No pending transfers.</p>
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>History</h3>
                <button class="close-btn" onclick="closeModal('historyModal')">&times;</button>
            </div>
            <div class="history-list">
                <div class="history-item">
                    <div class="history-icon sent"><i class='bx bx-up-arrow-alt'></i></div>
                    <div class="item-info">
                        <h4>Design_v2.fig</h4>
                        <p>Sent ‚Ä¢ 2 mins ago</p>
                    </div>
                    <span class="status-text">Done</span>
                </div>
                <div class="history-item">
                    <div class="history-icon received"><i class='bx bx-down-arrow-alt'></i></div>
                    <div class="item-info">
                        <h4>Photo_Pack.zip</h4>
                        <p>Received ‚Ä¢ 1 hr ago</p>
                    </div>
                    <span class="status-text">Saved</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Modal Logic
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
            document.getElementById('pin-error').style.display = 'none';
            // Auto focus if sending
            if(modalId === 'sendModal') {
                setTimeout(() => document.getElementById('real-pin').focus(), 300);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('open');
            if(modalId === 'sendModal') {
                setTimeout(() => {
                    document.getElementById('send-step-2').classList.remove('active');
                    document.getElementById('send-step-1').classList.add('active');
                    // Clear inputs
                    document.getElementById('real-pin').value = '';
                    updatePinVisuals(''); 
                }, 300);
            }
        }

        // --- NEW PIN LOGIC ---
        const realPinInput = document.getElementById('real-pin');
        const pinBoxes = document.querySelectorAll('.pin-box');

        realPinInput.addEventListener('input', (e) => {
            // Remove non-numeric characters just in case
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
            updatePinVisuals(e.target.value);
        });

        function updatePinVisuals(value) {
            pinBoxes.forEach((box, index) => {
                if (value[index]) {
                    box.textContent = value[index];
                    box.classList.add('filled');
                } else {
                    box.textContent = '';
                    box.classList.remove('filled');
                }
            });
        }

        // --- VALIDATION ---
        function nextStep() {
            const pinValue = realPinInput.value;
            if (pinValue.length === 6) {
                document.getElementById('pin-error').style.display = 'none';
                document.getElementById('send-step-1').classList.remove('active');
                document.getElementById('send-step-2').classList.add('active');
            } else {
                document.getElementById('pin-error').style.display = 'block';
                const wrapper = document.querySelector('.pin-visuals');
                wrapper.style.animation = 'shake 0.3s ease';
                setTimeout(() => wrapper.style.animation = '', 300);
            }
        }

        function prevStep() {
            document.getElementById('send-step-2').classList.remove('active');
            document.getElementById('send-step-1').classList.add('active');
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('open');
            }
        }
    </script>
    <style>
        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 
            50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 
            100% { transform: translateX(0); }
        }
    </style>
    <script src="../js/home.js"></script>
</body>
</html>