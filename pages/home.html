<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DShare - Home</title>
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/transfer.css"> 
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>

    <header class="main-header">
        <div class="header-action-left">
            <button id="backBtn" class="nav-btn invisible"><i class='bx bx-chevron-left'></i></button>
        </div>
        
        <div class="logo">D<span>Share</span></div>

        <div class="header-action-right">
            <a href="settings.html" class="nav-btn"><i class='bx bx-cog'></i></a>
        </div>
    </header>

    <main class="content-area">
        <div class="status-bar">
            <h2 id="viewTitle">Main Vault</h2>
            <button id="addFolderBtn" class="neon-plus"><i class='bx bx-plus'></i></button>
        </div>

        <div class="file-grid" id="fileGrid">
            </div>

        <input type="file" id="fileInput" hidden multiple>
    </main>
<div class="bottom-dock-container">
        <button class="dock-btn" onclick="openModal('receiveModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Receive</span>
        </button>

        <a href="history.html" class="dock-btn">
            <i class='bx bx-history'></i>
            <span>History</span>
        </a>

        <button class="dock-btn" onclick="openModal('sendModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            <span>Send</span>
        </button>
    </div>

    <div id="sendModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Send Files</h3>
                <button class="close-btn" onclick="closeModal('sendModal')">&times;</button>
            </div>

            <div id="send-step-1" class="step-content active">
                <p class="step-desc">Enter the 8-digit Receiver PIN to connect.</p>
                <div class="pin-input-group">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit" autofocus>
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                    <input type="text" placeholder="0" maxlength="1" class="pin-digit">
                </div>
                <button class="modal-action-btn" onclick="nextStep()">Connect & Select Files</button>
                <p id="pin-error" style="color: #ef4444; font-size: 12px; margin-top: 10px; display: none; text-align: center;">Please enter all 8 digits.</p>
            </div>

            <div id="send-step-2" class="step-content">
                <p class="step-desc">Select from your folders or attach new files.</p>
                
                <div class="file-selection-list">
                    <label class="file-item">
                        <input type="checkbox">
                        <span class="icon">üìÅ</span>
                        <span class="name">Project Alpha</span>
                    </label>
                    <label class="file-item">
                        <input type="checkbox">
                        <span class="icon">üìÑ</span>
                        <span class="name">Design_v2.fig</span>
                    </label>
                </div>

                <div class="upload-area">
                    <span>+ Attach External File</span>
                </div>

                <div class="modal-footer">
                    <button class="text-btn" onclick="prevStep()">Back</button>
                    <button class="modal-action-btn success">Send Now</button>
                </div>
            </div>
        </div>
    </div>

    <div id="receiveModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Incoming Files</h3>
                <button class="close-btn" onclick="closeModal('receiveModal')">&times;</button>
            </div>
            <div class="receive-list">
                <p class="empty-state">No pending transfers.</p>
            </div>
        </div>
    </div>

    <script>
        // Modal Logic
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
            // Reset error message when opening
            document.getElementById('pin-error').style.display = 'none';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('open');
            if(modalId === 'sendModal') {
                setTimeout(() => {
                    document.getElementById('send-step-2').classList.remove('active');
                    document.getElementById('send-step-1').classList.add('active');
                    // Clear inputs for security
                    document.querySelectorAll('.pin-digit').forEach(input => input.value = '');
                }, 300);
            }
        }

        // --- VALIDATION LOGIC ---
        function nextStep() {
            const inputs = document.querySelectorAll('.pin-digit');
            let fullPin = '';
            let isComplete = true;

            inputs.forEach(input => {
                if(input.value === '') {
                    isComplete = false;
                }
                fullPin += input.value;
            });

            if (isComplete && fullPin.length === 8) {
                // SUCCESS: Move to next step
                document.getElementById('pin-error').style.display = 'none';
                document.getElementById('send-step-1').classList.remove('active');
                document.getElementById('send-step-2').classList.add('active');
            } else {
                // ERROR: Show message
                document.getElementById('pin-error').style.display = 'block';
                // Shake animation effect
                const group = document.querySelector('.pin-input-group');
                group.style.animation = 'shake 0.3s ease';
                setTimeout(() => group.style.animation = '', 300);
            }
        }

        function prevStep() {
            document.getElementById('send-step-2').classList.remove('active');
            document.getElementById('send-step-1').classList.add('active');
        }

        // --- PIN INPUT LOGIC (Auto-focus) ---
        const pinInputs = document.querySelectorAll('.pin-digit');
        pinInputs.forEach((input, index) => {
            input.addEventListener('keyup', (e) => {
                if (e.key >= 0 && e.key <= 9) {
                    if (index < pinInputs.length - 1) {
                        pinInputs[index + 1].focus();
                    }
                } else if (e.key === 'Backspace') {
                    if (index > 0) {
                        pinInputs[index - 1].focus();
                    }
                }
            });
            // Prevent non-numeric input
            input.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('open');
            }
        }
    </script>
    <style>
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
    <script src="../js/home.js"></script>
</body>
</html>
   